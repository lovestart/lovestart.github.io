var Blood=function(t){function e(){t.call(this),this.xt()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.xt=function(){var t=new egret.Bitmap(RES.getRes("s2_fire2"));this.addChild(t),t.x=70;var e=new egret.Bitmap(RES.getRes("s2_fire1"));this.addChild(e),e.x=137,e.y=5,this.plan=e.width,this.shade=new egret.Shape,this.shade.graphics.beginFill(16711680,1),this.shade.graphics.drawRect(0,0,this.plan,60),this.shade.x=137,this.shade.y=e.y,this.shade.graphics.endFill(),this.addChild(this.shade),e.mask=this.shade,this.boom=new egret.Sprite,this.addChild(this.boom),this.boom.x=710,this.boom.y=25;var i=new egret.Bitmap(RES.getRes("s2_boom"));this.boom.addChild(i),i.x=-i.width/2,i.y=-i.height/2,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2;var s=new egret.Bitmap(RES.getRes("s2_boom"));this.boom.addChild(s),s.x=-30-s.width/2,s.y=20-i.height/2,s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2;var h=new egret.Bitmap(RES.getRes("s2_boom"));this.boom.addChild(h),h.x=-s.width/2,h.y=40-i.height/2,h.anchorOffsetX=h.width/2,h.anchorOffsetY=h.height/2,i.scaleX=i.scaleY=s.scaleX=s.scaleY=h.scaleX=h.scaleY=0,egret.Tween.get(i,{loop:1}).to({scaleX:1,scaleY:1},300),setTimeout(function(){egret.Tween.get(s,{loop:1}).to({scaleX:1,scaleY:1},300)},1e3),setTimeout(function(){egret.Tween.get(h,{loop:1}).to({scaleX:1,scaleY:1},300)},2e3)},s.changPlan=function(t){egret.Tween.removeTweens(this.shade),egret.Tween.get(this.shade).to({x:137-this.plan+this.plan*t/100},300),egret.Tween.get(this.boom).to({x:710-this.plan+this.plan*t/100},300)},e}(egret.Sprite);egret.registerClass(Blood,"Blood");var ChooseRedPacket=function(t){function e(e,i){void 0===i&&(i=[10,20,66,88,100]),t.call(this),this.hongbaoList=[],this.currentMoney=0,this._isMove=!1;for(var s=0;s<i.length;s++){var h=new egret.Sprite;this.addChild(h);var a=new egret.Bitmap(RES.getRes("s1_redpact"));h.addChild(a);var n=new egret.TextField;h.addChild(n),n.size=35,n.x=.4*a.width,n.textColor=16763904,n.text=i[s]+"",n.bold=!0,n.y=a.height-55,h.x=(a.width+20)*s+a.width,h.anchorOffsetX=a.width/2,h.anchorOffsetY=a.height/2,h.y=.8*-h.height,egret.Tween.get(h).wait(1200).to({y:.8*h.height+20},200*s).to({y:.8*h.height},100),this.hongbaoList.push(h),h.id=s,h.money=i[s],a.touchEnabled=h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)}this.bg=new egret.Bitmap(RES.getRes("s1_redBg")),this.bg.width=e,this.bg.height=1.5*h.height,this.addChild(this.bg),this.setHongBaoX()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addTouchEvent=function(){this.touchEnabled=!0,this.graphics.drawRect(0,0,this.bg.width,this.bg.height),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this)},s.touchBegin=function(t){function e(t){var e=t.stageX-a;e+=n,s(e),this._isMove=!0}function i(t){this.parent.removeEventListener(egret.TouchEvent.TOUCH_MOVE,e,this),this.parent.removeEventListener(egret.TouchEvent.TOUCH_END,i,this),this._isMove&&this.setHongBaoX()}function s(t){t>r?t=r:o>t&&(t=o);for(var e in d.hongbaoList)d.hongbaoList[e].scaleX=d.hongbaoList[e].scaleY=1,h=d.hongbaoList[e].width/2,t+=h,d.hongbaoList[e].x=t,Math.abs(t-r)<=h?d.hongbaoList[e].alpha=1:d.hongbaoList[e].alpha=.4,t+=h+20}var h,a=t.stageX,n=this.hongbaoList[0].x,r=this.bg.width/2,o=-(this.hongbaoList[0].width+20)*this.hongbaoList.length+r+this.hongbaoList[0].width/2,d=this;this._isMove=!1,this.parent.addEventListener(egret.TouchEvent.TOUCH_MOVE,e,this),this.parent.addEventListener(egret.TouchEvent.TOUCH_END,i,this)},s.touchEnd=function(t){if(!this._isMove){var e=t.currentTarget.id;this.setHongBaoX(e)}},s.setHongBaoX=function(t){void 0===t&&(t=null);var e=this.bg.width/2;if(null==t){t=0;for(var i=0;i<this.hongbaoList.length;i++)this.hongbaoList[i].scaleX=this.hongbaoList[i].scaleY=1,this.hongbaoList[i].alpha=.5,Math.abs(this.hongbaoList[i].x-e)<Math.abs(this.hongbaoList[t].x-e)&&(t=i)}else for(var i=0;i<this.hongbaoList.length;i++)this.hongbaoList[i].scaleX=this.hongbaoList[i].scaleY=1,this.hongbaoList[i].alpha=.5;if(this.currentMoney=this.hongbaoList[t].money,this.hongbaoList[t].alpha=1,this.hongbaoList[t].scaleX=this.hongbaoList[t].scaleY=1.5,egret.Tween.get(this.hongbaoList[t]).to({x:e,scaleX:1.5,scaleY:1.5},400),e=this.bg.width/2,e-=this.hongbaoList[t].width*this.hongbaoList[t].scaleX/2,0!=t)for(i=t-1;i>=0;i--)e-=this.hongbaoList[i].width/2+20,egret.Tween.get(this.hongbaoList[i]).to({x:e},400),e-=this.hongbaoList[i].width/2;if(e=this.bg.width/2,e+=this.hongbaoList[t].width*this.hongbaoList[t].scaleX/2,t!=this.hongbaoList.length-1)for(i=t+1;i<this.hongbaoList.length;i++)e+=this.hongbaoList[i].width/2+20,egret.Tween.get(this.hongbaoList[i]).to({x:e},400),e+=this.hongbaoList[i].width/2},e}(egret.Sprite);egret.registerClass(ChooseRedPacket,"ChooseRedPacket");var GameBg=function(t){function e(){t.call(this),this.word_distance=80}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initView=function(t){void 0===t&&(t=!0);var e=new egret.Shape;e.graphics.beginFill(15461355,1),e.graphics.drawRect(0,0,Main.stageWidth,Main.stageHeight),e.graphics.endFill(),e.touchEnabled=!0,this.addChild(e);var i=new egret.Bitmap(RES.getRes("s2_bg"));this.addChild(i),i.x=(Main.stageWidth-i.width)/2,i.y=(Main.stageHeight-i.height)/2;var s=new egret.Bitmap(RES.getRes("s2_input"));if(this.addChild(s),s.y=Main.stageHeight-s.height,t){var h=this;LoadView.getInstance().load_data(3),Service.getInstance().getRedpacketInfo(function(t){LoadView.getInstance().load_data(-1),1==t?h.dispatchEvent(new egret.Event("addOk")):h.dispatchEvent(new egret.Event("addOver"))})}},s.startAni=function(){var t=new egret.Sprite,e=new egret.TextField;e.size=25,e.width=.22*Main.stageWidth,e.text="过年好",e.textAlign="center",e.textColor=16777215,t.graphics.beginFill(13421772),t.graphics.drawRoundRect(0,0,e.width,45,20,20),t.y=15,e.y=9,t.x=Main.stageWidth/2-e.width/2,t.addChild(e),this.addChild(t);var i=Main.gameDescription.dialogue.start1,s=Service.getInstance().monsterName;s||(s=""),i=i.replace(/@mName/,Service.getInstance().monsterName),Main.gameDescription.dialogue.start1=i.replace(/@uName/,Service.getInstance().userNickname),this.tallSp=new egret.Sprite,this.addChild(this.tallSp);var h=0,a=this,n=setInterval(function(){0==h?a.moreWord("start1"):1==h?a.moreWord("start2"):2==h?a.moreWord("start3"):3==h&&(a.initEvent(),clearInterval(n)),h++},1200)},s.moreWord=function(t){var e=new egret.Sprite;this.tallSp.addChild(e);var i=new egret.Bitmap(RES.getRes("game_girl"));if(e.addChild(i),i.width=75,i.height=75,i.x=25,i.y=8,Service.getInstance().monsterHeadimgurl&&LoadView.getInstance().load_img(i,Service.getInstance().monsterHeadimgurl),"start2"==t){var s=new egret.Bitmap(RES.getRes("s2_money"));e.addChild(s),s.x=i.x+i.width+5;var h=new egret.TextField;h.text=Service.getInstance().redPacketMoney+"元",h.fontFamily="微软雅黑",h.x=s.x+.284*s.width,h.y=.45*s.height,e.addChild(h)}else{var a=Main.gameDescription.dialogue[t];"continuousNoHit"==t&&(a=a[Math.floor(Math.random()*a.length)]);var n=new DBubble(a,.7*Main.stageWidth,32);e.addChild(n),n.x=i.x+i.width+5}e.y=this.word_distance+5,e.alpha=0,egret.Tween.get(e).to({alpha:1,y:this.word_distance},200),this.word_distance+=e.height+20,this.sc&&this.sc.stop();var r=RES.getRes("news_music");r.play(0,1),this.tallSp.height>Main.stageHeight-.22*Main.stageWidth&&(this.tallSp.y=Main.stageHeight-.22*Main.stageWidth-this.tallSp.height)},s.initEvent=function(){this.startGame()},s.startGame=function(){this.sc&&this.sc.stop(),this.dispatchEvent(new egret.Event("gameStart"))},s.overAni=function(){},s.clear=function(){},e}(egret.Sprite);egret.registerClass(GameBg,"GameBg");var GameHint=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.clickScene=function(){function t(){s.parent.touchEnabled=!1,s.parent.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,t,s),egret.Tween.removeTweens(e),s.dispatchEvent(new egret.Event("ok"))}var e=new egret.Bitmap(RES.getRes("s2_click"));this.addChild(e),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,egret.Tween.get(e,{loop:1}).to({scaleX:.8,scaleY:.8},300).to({scaleX:1,scaleY:1},500);var i=new egret.Bitmap(RES.getRes("s2_fashe"));this.addChild(i),i.y=200,i.x=-i.width/2;var s=this;setTimeout(function(){egret.Tween.get(e).to({alpha:0},600).call(function(){},this),egret.Tween.get(i).to({alpha:0},600)},2e3),this.parent.touchEnabled=!0,this.parent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t,this)},e}(egret.Sprite);egret.registerClass(GameHint,"GameHint");var GamePlay=function(t){function e(){t.call(this),this.hitNum=1,this.HP=100,this.timeNum=0,this.bulletList=[],this._isSend=!1,this.continuousHitNum=0,this.continuousNoHitNum=0,this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.initView()},s.initView=function(){this.graphics.beginFill(0,.6),this.graphics.drawRect(0,0,Main.stageWidth,Main.stageHeight),this.graphics.endFill(),this.boss=new Monster,this.addChild(this.boss),this.addTurretView(),this.blood=new Blood,this.addChild(this.blood),this.blood.y=-this.blood.height,this.blood.x=-20,this.musicBtn=new MusicBtn,this.addChild(this.musicBtn),this.startAni()},s.addTurretView=function(){this.turretView=new egret.Sprite,this.addChild(this.turretView);var t=new egret.Bitmap(RES.getRes("game_frame"));this.turretView.addChild(t);var e=new egret.Bitmap;this.turretView.addChild(e),e.width=e.height=137,e.x=(t.width-e.width)/2+2,e.y=t.height-e.height-5,LoadView.getInstance().load_img(e,Service.getInstance().userHeadImgUrl);var i=new egret.Shape;i.x=e.width/2+e.x,i.y=e.height/2+e.y,i.graphics.beginFill(16711680,1),i.graphics.drawCircle(0,0,e.width/2),i.graphics.endFill(),this.turretView.addChild(i),e.mask=i,this.turretView.anchorOffsetX=this.turretView.width/2,this.turretView.anchorOffsetY=this.turretView.height/2,this.turretView.y=Main.stageHeight+this.turretView.height/2,this.turretView.x=Main.stageWidth/2},s.startAni=function(){function t(){n<h.length?(r.boss.y=Math.random()*Main.stageHeight*.6+.2*Main.stageWidth,1==h[n]?(r.boss.scaleX=1,r.boss.x=Main.stageWidth+r.boss.width/2,5*Math.random()<3&&egret.Tween.get(r.boss).to({scaleX:1.05,scaleY:.95},400).to({scaleX:.95,scaleY:1.02},200).to({scaleX:1,scaleY:1},100,egret.Ease.backIn),egret.Tween.get(r.boss).to({x:Main.stageWidth-.45*r.boss.width},500,egret.Ease.backOut).wait(300*Math.random()+800).to({x:Main.stageWidth+r.boss.width/2},300,egret.Ease.backOut).call(t,r)):(r.boss.scaleX=-1,r.boss.x=-r.boss.width/2,5*Math.random()<3&&egret.Tween.get(r.boss).to({scaleX:-1.05,scaleY:.95},400).to({scaleX:-.95,scaleY:1.02},200).to({scaleX:-1,scaleY:1},100,egret.Ease.backIn),egret.Tween.get(r.boss).to({x:.45*r.boss.width},500,egret.Ease.backOut).wait(200*Math.random()+800).to({x:-r.boss.width/2},300,egret.Ease.backOut).call(t,r))):e(),n++}function e(){r.boss.scaleX=1,r.boss.setMoveType(),o.graphics.beginFill(0),o.graphics.drawRect(0,0,2*r.boss.width,r.boss.height),r.addChild(o),r.boss.mask=o,o.x=.2*Main.stageWidth,o.y=.45*Main.stageWidth,r.boss.y=o.y+.72*r.boss.height,r.boss.x=o.x-r.boss.width/2,egret.Tween.get(r.boss).to({scaleX:1.05,scaleY:.95},400).to({scaleX:.9,scaleY:1.02},200).to({scaleX:1,scaleY:1},100),egret.Tween.get(r.boss).to({x:o.x+r.boss.width/2},300,egret.Ease.backOut).call(i)}function i(){r.boss.mask=null,r.removeChild(o),o=null,egret.Tween.get(r.turretView).to({y:Main.stageHeight-r.turretView.height/2},400),egret.Tween.get(r.blood).to({y:60},500).wait(300).call(s)}function s(){var t=new GameHint;r.addChild(t),t.clickScene(),t.x=Main.stageWidth/2,t.y=Main.stageHeight/2,t.addEventListener("ok",function(){r.removeChild(t),t=null,r.initEvent()},r)}this.boss.setRightType();var h=[],a=5*Math.random();2>a?h=[1,2]:3>a?h=[2,1]:4>a?h=[2]:5>=a&&(h=[1]);var n=0,r=this,o=new egret.Shape;t()},s.initEvent=function(){this.touchEnabled=!0,this.timerTxt=new egret.TextField,this.timerTxt.size=40,this.timerTxt.width=90,this.timerTxt.x=Main.stageWidth-this.timerTxt.width-15,this.timerTxt.y=this.blood.y+this.blood.height+25,this.timerTxt.textAlign="center",this.timerTxt.text="GO",this.addChild(this.timerTxt),this.graphics.lineStyle(3,16777215),this.graphics.beginFill(0,.3),this.graphics.drawCircle(this.timerTxt.x+this.timerTxt.width/2,this.timerTxt.y+this.timerTxt.size/2,this.timerTxt.width/2),this.graphics.endFill(),this.timeNum=Main.gameDescription.gameMaxTime,this.timer=new egret.Timer(1e3),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerEvent,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnter,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.sendBullet,this),this.boss.setHeadMove(),this._isSend=!0,this.timer.start()},s.timerEvent=function(t){this.timeNum--,this.timerTxt.text=this.timeNum+"s";var e=100*Math.random();this.timeNum%2==0&&e<100*Main.gameDescription.monsterTurningProbability&&(this.boss.moveSpeed*=-1),this.timeNum<=0?this.gameOver():2==this.timeNum&&this.dispatchEvent(new egret.Event("willOver"))},s.onEnter=function(t){this.boss.update();var e,i,s=this.boss.x+.12*Main.stageWidth,h=this.boss.y-30;for(var a in this.bulletList)e=this.bulletList[a],e.x>0&&e.x<Main.stageWidth&&e.y>200&&e.y<Main.stageHeight?(e.x+=e.ax,e.y+=e.ay,i=Math.sqrt(Math.pow(e.x-s,2)+Math.pow(e.y-h,2)),i<.12*Main.stageWidth&&(this.continuousHitNum++,this.continuousNoHitNum=0,this.continuousHitNum>2&&(this.boss.setNoHitType(),this.dispatchEvent(new egret.Event("continuousHit")),this.continuousHitNum=0),this.addBomAni(e.x,e.y),this.boss.setHitType(),e.hit=!0,e.y=-200,this.HP-=100*Main.gameDescription.hurtNum,this.blood.changPlan(this.HP),this.HP<=0&&this.gameOver()),1==e.sType?(e.scaleX=e.scaleY+=.1,e.scaleX>1.3&&(e.scaleX=e.scaleY=1.3,e.sType=2)):2==e.sType&&(e.scaleX=e.scaleY-=.01,e.scaleX<.7&&(e.scaleX=e.scaleY=.7,e.alpha=.8,e.sType=3))):(e.hit||(this.continuousHitNum=0,this.continuousNoHitNum++,this.continuousNoHitNum>=Main.gameDescription.dialogue_continuousNoHit_num&&(this.boss.setNoHitType(),this.dispatchEvent(new egret.Event("continuousNoHit")),this.continuousNoHitNum=0)),this.removeChild(e),this.bulletList.splice(Number(a),1),e=null)},s.sendBullet=function(t){if(this._isSend){var e=t.stageX,i=t.stageY;if(i>200){var s=180*Math.atan2(i-this.turretView.y,e-this.turretView.x)/Math.PI,h=new egret.Bitmap(RES.getRes("game_bullet"));h.anchorOffsetX=h.width/2,h.anchorOffsetY=h.height/2,this.addChild(h),h.rotation=s+90;var a=Math.cos(s*Math.PI/180),n=Math.sin(s*Math.PI/180);h.x=this.turretView.x+a*(this.turretView.width/2+h.height/2),h.y=this.turretView.y+n*(this.turretView.width/2+h.height/2),h.ax=a*Main.gameDescription.bulletSpeed,h.ay=n*Main.gameDescription.bulletSpeed,h.sType=1,this.bulletList.push(h),this._isSend=!1;var r=this;setTimeout(function(){r._isSend=!0},1e3*Main.gameDescription.bulletCD);var s=100*Math.random();s<100*Main.gameDescription.monsterUpSpeedProbability&&(r.boss.moveSpeed>0?this.boss.moveSpeed=Main.gameDescription.monsterUpSpeed:this.boss.moveSpeed=-Main.gameDescription.monsterUpSpeed,setTimeout(function(){r.boss.moveSpeed>0?r.boss.moveSpeed=Main.gameDescription.monsterSpeed:r.boss.moveSpeed=-Main.gameDescription.monsterSpeed},1e3*Main.gameDescription.monsterUpSpeedTime));var o=RES.getRes("boom_music");o.play(0,1)}}},s.addBomAni=function(t,e){var i=new egret.Bitmap(RES.getRes("s2_boom"));i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=t,i.y=e;var s=1*Math.random()+1.5;this.addChild(i),egret.Tween.get(i).to({scaleX:s,scaleY:s},300).wait(100).to({alpha:0},100).call(function(){this.removeChild(i)},this);var h=new HitNum(this.hitNum);this.addChild(h),h.x=this.boss.x+.12*Main.stageWidth,h.y=this.boss.y-this.boss.height/1.5,this.hitNum++,egret.Tween.get(h).wait(600).to({alpha:0,y:this.boss.y-this.boss.height/1.5-20},600).call(function(){this.removeChild(h)},this)},s.gameOver=function(){var t=this;this.timer.stop(),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.sendBullet,this),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerEvent,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnter,this),this.musicBtn.closeMusic(),Service.getInstance().submitScore(this.HP,function(){t.dispatchEvent(new egret.Event("endSpace"))})},s.clear=function(){},e}(egret.Sprite);egret.registerClass(GamePlay,"GamePlay");var GameScene1=function(t){function e(){t.call(this),this.mName="",this.monster_money=[];var e=this;LoadView.getInstance().loadingGroup("scene1",!0,function(){e.init()})}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.initView()},s.initView=function(){var t=new egret.Bitmap(RES.getRes("s1_bg"));this.addChild(t),t.touchEnabled=!0;var e=new egret.Bitmap(RES.getRes("s1_top"));this.addChild(e),e.x=(Main.stageWidth-e.width)/2,e.y=e.x;var i=new egret.Bitmap(RES.getRes("s1_bottom"));this.addChild(i),i.x=e.x,i.y=Main.stageHeight-i.height-e.y;var s=new egret.Bitmap(RES.getRes("s1_center"));this.addChild(s),s.x=e.x,s.y=e.height+e.y,s.height=Main.stageHeight-e.height-i.height-2*e.y,this.chooseRedPacket=new ChooseRedPacket(e.width-12,Main.gameDescription.redPacket_list);var h=new egret.Shape;h.graphics.beginFill(65280),h.graphics.drawRect(0,0,e.width-12,1.6*e.height),this.addChild(h),h.y=this.chooseRedPacket.y=70,h.x=this.chooseRedPacket.x=e.x+6,this.addChildAt(this.chooseRedPacket,1),this.chooseRedPacket.mask=h,this.monster_name=new egret.TextField,this.monster_name.width=.4*Main.stageWidth,this.monster_name.height=70,this.monster_name.textAlign="center",this.monster_name.type="input",this.monster_name.x=(Main.stageWidth-this.monster_name.width)/2,this.monster_name.y=this.chooseRedPacket.y+.65*this.chooseRedPacket.height,this.monster_name.fontFamily="微软雅黑",this.monster_name.size=35,this.monster_name.maxChars=8,this.addChild(this.monster_name),this.setTextStyle();var a=new egret.Shape;a.graphics.lineStyle(4,12190470),a.graphics.moveTo(0,0),a.graphics.lineTo(this.monster_name.width+20,0),a.graphics.endFill(),a.x=this.monster_name.x-10,a.y=this.monster_name.y+45,this.addChild(a);var n=new egret.MovieClipDataFactory(RES.getRes("s1_ani1_json"),RES.getRes("s1_ani1"));this.ani=new egret.MovieClip(n.generateMovieClipData("mw")),this.addChild(this.ani),this.ani.anchorOffsetX=this.ani.width/2,this.ani.anchorOffsetY=this.ani.height/2;var r=new egret.Sprite;this.addChild(r),this.monster_head=new egret.Sprite;var o=new egret.Bitmap(RES.getRes("s1_head"));this.monster_head.addChild(o),this.monster_head.anchorOffsetX=.6*this.monster_head.width,this.monster_head.anchorOffsetY=.7*this.monster_head.height,this.monster_head.y=.062*-this.monster_head.height,this.monster_head.x=.1*this.monster_head.height;var d=new egret.Bitmap(RES.getRes("biaoqing"));this.monster_head.addChild(d),d.scaleX=d.scaleY=2,d.x=75,d.y=135;var g=new egret.Bitmap(RES.getRes("s1_body"));r.addChild(g),g.x=-g.width/3.5,r.addChild(this.monster_head),r.visible=!1,r.scaleX=r.scaleY=Main.stageHeight/1400,this.pay=new MyButton("s1_start"),this.addChild(this.pay),this.pay.x=Main.stageWidth/2,this.pay.y=i.y-this.pay.height,this.push=new MyButton("s1_photo"),this.addChild(this.push),this.push.x=Main.stageWidth/2,this.push.y=this.pay.y-2*this.push.height-30,r.y=this.push.y-r.height*r.scaleY/1.5+50,this.ani.scaleX=this.ani.scaleY=Main.stageHeight/1300,this.ani.x=.4*Main.stageWidth-this.ani.scaleX*this.ani.width/2,this.ani.y=this.push.y-this.ani.height*this.ani.scaleY*1.5+80,r.x=this.ani.x+r.width*r.scaleX*.7,this.monster=r,this.ani.play(-1);for(var c=0;5>c;c++){var l=new egret.Bitmap(RES.getRes("s1_red"));this.addChild(l),l.anchorOffsetX=5,l.anchorOffsetY=5,l.x=this.ani.x+this.ani.width*this.ani.scaleX*1.15,l.y=this.ani.y+this.ani.width*this.ani.scaleX*1.1,l.rotation=-130,egret.Tween.get(l).wait(100*c).to({rotation:-130+32*c+10},200).to({rotation:-130+32*c},100),this.monster_money.push(l)}this.musicBtn=new MusicBtn,this.addChild(this.musicBtn),this.musicBtn.x=-30,this.musicBtn.y=this.monster_name.y-45;var m=navigator.userAgent,p=m.indexOf("Android");if(p>=0){var u=parseFloat(m.slice(p+8));4>=u&&(this.monster.visible=!0,this.ani.visible=!1)}else{var v=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),w=parseInt(String(v[1]),10);9>w&&(this.monster.visible=!0,this.ani.visible=!1)}this.startAni()},s.startAni=function(){this.initEvent()},s.initEvent=function(){var t=this;this.monster_name.addEventListener(egret.FocusEvent.FOCUS_IN,function(){"给年兽起个名字吧"==t.monster_name.text&&(t.monster_name.text=""),this.monster_name.textColor=0},this),this.monster_name.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){t.setTextStyle()},this),this.chooseRedPacket.addTouchEvent(),this.push.addTouchEvent(),this.push.addEventListener(egret.TouchEvent.TOUCH_END,this.pushPhone,this),this.pay.addTouchEvent(),this.pay.addEventListener("click",this.WeiXinPay,this);var e=new egret.Bitmap(RES.getRes("gif"));this.addChild(e)},s.pushPhone=function(t){var e=this;egret.choosePhone(function(t,i){e.chooseHead||(e.chooseHead=new egret.Bitmap,e.monster_head.addChildAt(e.chooseHead,1)),Service.getInstance().headBase64Data=i,e.chooseHead.bitmapData=t,e.chooseHead.width=.3*Main.stageWidth,e.chooseHead.height=.65*e.chooseHead.width,e.chooseHead.rotation=-32,e.chooseHead.x=.13*e.monster_head.width,e.chooseHead.y=.57*e.monster_head.width,egret.Tween.removeTweens(e.monster_head),egret.Tween.get(e.monster_head).to({rotation:-20},300).to({rotation:10},500).to({rotation:-20},500).to({rotation:10},500).to({rotation:0},230),e.ani.visible&&(e.monster.visible=!0,e.monster_money=null,e.ani.visible=!1)})},s.WeiXinPay=function(){function t(){Service.getInstance().weixinPay(i,function(t){var i={appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,paySign:t.paySign,signType:"MD5","package":"prepay_id="+t.prepayId};egret.wx.chooseWXPay({timestamp:i.timeStamp,nonceStr:i.nonceStr,"package":i["package"],signType:i.signType,paySign:i.paySign,success:function(t){e()}})})}function e(){var t=Service.getInstance().headBase64Data;Service.getInstance().createRedpacket(i,Service.getInstance().monsterName,t,function(t){t.packetId&&(Main.share("share2",Service.getInstance().userNickname,Service.getInstance().monsterName,t.packetId),s.endAni())})}var i=Number(this.chooseRedPacket.currentMoney),s=this;Service.getInstance().monsterName=this.mName,t()},s.endAni=function(){var t=new egret.Shape;t.graphics.beginFill(0,.3),t.graphics.drawRect(0,0,Main.stageWidth,Main.stageHeight),t.graphics.endFill(),t.touchEnabled=!0,this.addChild(t);var e=new egret.Bitmap(RES.getRes("s1_tishi"));this.addChild(e),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=Main.stageWidth/2,e.y=620;var i=new egret.Bitmap(RES.getRes("s1_jiantou"));this.addChild(i),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=Main.stageWidth-220,i.y=200},s.clear=function(){},s.setTextStyle=function(){""==this.monster_name.text||"给年兽起个名字吧"==this.monster_name.text?(this.monster_name.text="给年兽起个名字吧",this.monster_name.textColor=7829367,this.mName=""):(this.monster_name.textColor=0,this.mName=this.monster_name.text)},e}(egret.Sprite);egret.registerClass(GameScene1,"GameScene1");var GameScene2=function(t){function e(){t.call(this);var e=this;LoadView.getInstance().loadingGroup("scene2",!0,function(){e.init()})}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.initView()},s.initView=function(){this.gameBg=new GameBg,this.addChild(this.gameBg),this.gameBg.addEventListener("addOver",this.addOverView,this),this.gameBg.addEventListener("addOk",this.addHbBg,this),this.gameBg.initView()},s.addHbBg=function(){var t=new egret.Shape;t.graphics.beginFill(0,.5),t.graphics.drawRect(0,0,Main.stageWidth,Main.stageHeight),this.addChild(t),this.sp=t,this.hbSp=new egret.Sprite,this.hbSp.y=Main.stageHeight/2,this.hbSp.scaleX=this.hbSp.scaleY=0,this.addChild(this.hbSp);var e=new egret.Bitmap(RES.getRes("game_chai"));this.hbSp.addChild(e),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,this.hbSp.x=Main.stageWidth/2,egret.Tween.get(this.hbSp).wait(600).to({scaleX:1,scaleY:1},500,egret.Ease.backOut).call(function(){var t=new egret.Bitmap(RES.getRes("game_hbbg"));this.hbSp.addChildAt(t,0),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2;var i=e.height/2,s=-115,h=.6*e.height;t.x=Math.cos(Math.PI*s/180)*i,t.y=Math.sin(Math.PI*s/180)*i+e.height/2;var a=Math.cos(Math.PI*s/180)*h,n=Math.sin(Math.PI*s/180)*h+e.height/2;t.alpha=0,t.rotation=s+90,egret.Tween.get(t).wait(40).to({y:n,x:a,alpha:1},350,egret.Ease.backOut);var t=new egret.Bitmap(RES.getRes("game_hbbg"));this.hbSp.addChildAt(t,0),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,i=e.height/2,s=-74,h=.7*e.height,t.scaleX=t.scaleY=1.2,t.x=Math.cos(Math.PI*s/180)*i,t.y=Math.sin(Math.PI*s/180)*i+e.height/2,a=Math.cos(Math.PI*s/180)*h,n=Math.sin(Math.PI*s/180)*h+e.height/2,t.alpha=0,t.rotation=s+90,egret.Tween.get(t).wait(450).to({y:n,x:a,alpha:1},500,egret.Ease.backOut).call(function(){var t=new egret.Bitmap(RES.getRes("game_hbbg"));this.hbSp.addChildAt(t,0),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,i=0,s=-10,h=.3*e.height,t.scaleX=t.scaleY=.95,t.x=Math.cos(Math.PI*s/180)*i,t.y=Math.sin(Math.PI*s/180)*i,a=Math.cos(Math.PI*s/180)*h,n=Math.sin(Math.PI*s/180)*h,t.alpha=0,t.rotation=s+90,egret.Tween.get(t).to({y:n,x:a,alpha:1},500,egret.Ease.backOut).call(function(){this.graphics.clear(),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_END,this.startAni,this)},this)},this)},this)},s.startAni=function(){this.removeChild(this.hbSp),this.removeChild(this.sp);var t=RES.getRes("laugh_music");t.play(0,1),this.gameBg.startAni(),this.initEvent()},s.initEvent=function(){var t=this;this.gameBg.addEventListener("gameStart",function(){Service.getInstance().getGameInfo(function(){t.addGame()})},this)},s.addGame=function(){function t(t){this.gameBg.moreWord(t.type)}this.gamePlay=new GamePlay,this.addChild(this.gamePlay),this.gamePlay.addEventListener("willOver",t,this),this.gamePlay.addEventListener("continuousHit",t,this),this.gamePlay.addEventListener("continuousNoHit",t,this),this.gamePlay.addEventListener("endSpace",this.addOverView,this)},s.addOverView=function(){this.moneyShow=new MoneyShow,this.addChild(this.moneyShow);var t=this;this.moneyShow.addEventListener("gored",function(){t.dispatchEvent(new egret.Event("gored"))},this)},s.overAni=function(){},s.clear=function(){},e}(egret.Sprite);egret.registerClass(GameScene2,"GameScene2");var HitNum=function(t){function e(e){void 0===e&&(e=100),t.call(this),this.w=0;var i=new egret.Bitmap(RES.getRes("s2_jia"));this.addChild(i),i.x=this.w,i.y=5,this.w+=i.width+10;var s=String(e).split("");for(var h in s){var a=new egret.Bitmap(RES.getRes("s2_"+s[h]));this.addChild(a),a.x=this.w,this.w+=a.width+3}}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.Sprite);egret.registerClass(HitNum,"HitNum");var MyButton=function(t){function e(e){t.call(this),this.str1="",this.str1=e,this.addCard(this.str1)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addTouchEvent=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this)},s.setAnchoffset=function(t,e){this.card.anchorOffsetX=this.card.width*t,this.card.anchorOffsetY=this.card.height*e},s.touchBegin=function(t){egret.Tween.get(this).to({scaleX:1.1,scaleY:1.1},100),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchEnd,this)},s.touchEnd=function(t){this.touchEnabled=!1,this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchEnd,this),egret.Tween.get(this).to({scaleX:1,scaleY:1},150).call(function(){this.touchEnabled=!0,"touchmove"!=t.type&&this.dispatchEvent(new egret.Event("click"))},this)},s.clear=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},s.addCard=function(t){null==this.card&&(this.card=new egret.Bitmap,this.addChild(this.card)),this.card.texture=RES.getRes(t),this.card.x=-this.card.width/2,this.card.y=-this.card.height/2},e}(egret.Sprite);egret.registerClass(MyButton,"MyButton");var DBubble=function(t){function e(e,i,s,h){void 0===s&&(s=35),void 0===h&&(h=0),t.call(this);var a=new egret.TextField;a.size=s,a.width=i,a.fontFamily="΢���ź�",a.lineSpacing=16,a.textColor=0;var n=new egret.Bitmap(RES.getRes("s2_qi"));this.addChild(n),n.y=15,a.x=n.width-5.9+20,a.y=30,a.text=e,this.addChild(a);var r=new egret.Bitmap;r.texture=RES.getRes("s2_jiu");var o=new egret.Rectangle(11.95,13.05,24.2,66.6);r.scale9Grid=o,r.width=a.textWidth+40,r.height=a.textHeight+60,r.x=n.width-5.9,this.addChildAt(r,0)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.Sprite);egret.registerClass(DBubble,"DBubble");var Service=function(){function t(){this.host="http://wx.wezhuxue.com/",this.pId="test3",this.cId=0,this.weixinShareUrl="wezhuxue-weixin/testJsSdkServlet",this.link="",this.errorPage="h5/php/module/errorPage/?type=1&message=",this.gameLevel=1,this._isWxSDKAutho=!1,this.link=this.host+"wezhuxue-weixin/authCode"}var e=(__define,t),i=e.prototype;return t.getInstance=function(){return this.service||(this.service=new t),this.service},i.getUrlInfo=function(){var t=window.location.href.split("?"),e=new Array;if(t.length>1)for(var i=t[1].split("&"),s=0,h=i.length;h>s;s++){var a=i[s].split("=");e[a[0]]=a[1]}e.openId?this.userOpenId=e.openId:Popup.getInstance().myAlert2("用户id为空",3e3),e.nickName&&(this.userNickname=decodeURI(e.nickName)),e.packetId&&(this.redId=e.packetId),e.AH_test&&(egret.test=1),e.to&&(0==Number(e.to)?this.gameLevel=1:1==Number(e.to)?this.gameLevel=2:2==Number(e.to)&&(this.gameLevel=3))},i.weixinPay=function(t,e){this.getServiceInfo(this.host+"wezhuxue-weixin/testPayServlet",{openId:this.userOpenId,amount:t,subject:"年兽红包",remoteAddr:"192.168.10.1"},function(t){e(t)})},i.createRedpacket=function(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),this.getServiceInfo(this.host+"wezhuxue-weixin/testPacketServlet",{method:"createPacket",openId:this.userOpenId,packetName:e,packetImg:i,wxName:this.userNickname,packetMoney:t},function(t){s(t)})},i.getRedpacketInfo=function(e){var i=this;LoadView.getInstance().load_data(3),this.getServiceInfo(this.host+"wezhuxue-weixin/testPacketServlet",{method:"packetBasic",packetId:this.redId,openId:this.userOpenId},function(s){i.userNickname=s.wxName,i.monsterName=s.packetName,i.redPacketMoney=s.packetMoney,s.packetImg&&""!=s.packetImg&&(i.monsterHeadimgurl=s.packetImg),Main.share("share1",t.getInstance().userNickname,t.getInstance().monsterName,i.redId),e(Number(s.grabStatus)),LoadView.getInstance().load_data(-1)},!1)},i.getGameInfo=function(t){var e=this;this.getServiceInfo(this.host+"wezhuxue-weixin/testPacketServlet",{method:"userAndPacketInfo",packetId:this.redId,openId:e.userOpenId},function(i){Main.gameDescription.hurtNum=Number(i.hitPercent),Main.gameDescription.gameMaxTime=Number(i.gameTime),e.userHeadImgUrl=i.userAvatar,e.userNickname2=i.userNickName,t(i)})},i.submitScore=function(t,e){var i=this,s=Math.floor(9*Math.random())+1;this.getServiceInfo(this.host+"wezhuxue-weixin/testPacketServlet",{method:"grabThePacket",packetId:this.redId,openId:i.userOpenId,hitPercent:1-t/100,couplet:s},function(t){e(t)})},i.getOverInfo=function(t){var e=this;Math.floor(9*Math.random())+1;this.getServiceInfo(this.host+"wezhuxue-weixin/testPacketServlet",{method:"grabPacketInfo",packetId:this.redId,openId:e.userOpenId},function(e){t(e)})},i.weixinShare=function(t,e,i,s,h){function a(){o.onMenuShareTimeline({title:l.desc,link:l.link,imgUrl:l.imgUrl,success:function(){n(1)},cancel:function(){}}),o.onMenuShareAppMessage({title:l.title,desc:l.desc,link:l.link,imgUrl:l.imgUrl,success:function(){n(2)},cancel:function(){}}),o.onMenuShareQQ({title:l.title,desc:l.desc,link:l.link,imgUrl:l.imgUrl,success:function(){n(3)},cancel:function(){}}),o.onMenuShareWeibo({title:l.title,desc:l.desc,link:l.link,imgUrl:l.imgUrl,success:function(){n(4)},cancel:function(){}})}function n(t){h&&h(t)}function r(){function t(t){c.getServiceInfo(c.host+c.weixinShareUrl,{url:window.location.href,mId:1},function(e){g=e,t()
},!1)}t(function(){o.config({debug:!1,appId:g.appId,timestamp:g.timeStamp,nonceStr:g.nonceStr,signature:g.signature,jsApiList:["chooseWXPay","uploadImage","chooseImage","hideMenuItems","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]}),o.ready(function(){c._isWxSDKAutho=!0,a(),o.hideMenuItems({menuList:["menuItem:share:qq","menuItem:share:weiboApp","menuItem:share:QZone","menuItem:copyUrl","menuItem:openWithQQBrowser","menuItem:openWithSafari","menuItem:share:email","menuItem:share:brand","menuItem:favorite"]})}),o.error(function(t){})})}void 0===s&&(s=null),void 0===h&&(h=null);var o=egret.wx;if(null!=o){var d=this.link;d+=s?"?to=1&packetId="+s:"?to=0";var g,c=this,l={title:t,link:d,imgUrl:e,desc:i};this._isWxSDKAutho?a():r()}},i.getServiceInfo=function(t,e,i,s){void 0===s&&(s=!0),s&&LoadView.getInstance().load_data(),this.trace("----------------------------------"),this.trace(t+"前端请求："),this.trace(e);var h=this;egret.baseService(t,e,"post",function(e){h.trace(t+"后端返回数据："),h.trace(e),s&&LoadView.getInstance().load_data(-1),e?200==Number(e.code)?i(e):Popup.getInstance().myAlert2("错误:"+e.code,3e3):Popup.getInstance().myAlert2("服务器未知异常")},function(){Popup.getInstance().myAlert2("服务器开小差了")})},i.trace=function(t){egret.test&&console.log(t)},t}();egret.registerClass(Service,"Service");var LoadView=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){return this.view||(this.view=new e),this.view},s.load_defaultJson=function(){function t(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,t,e),e.dispatchEvent(new egret.Event("defaultJsonOk")),e=null}var e=this;RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,t,this),RES.loadConfig("resource/default.res.json","resource/")},s.loadingGroup=function(t,e,i){function s(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,s,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,h,this),this.loadingUI&&this.loadingUI.setLoading(-1),i()}function h(t){this.loadingUI.setProgress(t.itemsLoaded,t.itemsTotal)}RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,s,this),e&&(this.loadingUI||(this.loadingUI=new LoadingUI,this.addChild(this.loadingUI)),this.loadingUI.setLoading(1),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,h,this)),RES.loadGroup(t)},s.load_data=function(t){void 0===t&&(t=2),this.loadingUI||(this.loadingUI=new LoadingUI,this.addChild(this.loadingUI)),t?this.loadingUI.setLoading(t):this.loadingUI.setLoading(-1)},s.load_img=function(t,e){function i(e){var i=e.currentTarget,h=i.data;t&&(t.bitmapData=h),s=null}var s=new egret.ImageLoader;s.once(egret.Event.COMPLETE,i,this),s.load(e)},s.getPoint=function(t){document.addEventListener("keydown",function(e){switch(e.key){case"ArrowRight":t.x+=5;break;case"ArrowLeft":t.x-=5;break;case"ArrowUp":t.y-=5;break;case"ArrowDown":t.y+=5}console.log(t.x+"--------------()"+t.y)})},e}(egret.Sprite);egret.registerClass(LoadView,"LoadView");var Popup=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){return this.tanchuang||(this.tanchuang=new e),this.tanchuang},s.myAlert2=function(t,e){void 0===e&&(e=1500);var i,s,h=new egret.Sprite,a=new egret.TextField;this.addChild(h),h.addChild(a),a.textColor=16777215,a.fontFamily="微软雅黑",a.text=t,a.size=30,a.x=35,a.y=30,i=a.textWidth+2*a.x,s=a.size+2*a.y,h.graphics.beginFill(0,.4),h.graphics.lineStyle(2,8947848,.9),h.graphics.drawRoundRect(0,0,i,s,25,25),h.graphics.endFill(),h.x=Main.stageWidth/2-i/2,h.y=Main.stageHeight/2-s/2+20,h.alpha=0,egret.Tween.get(h).to({y:h.y-20,alpha:1},100).wait(e).to({y:h.y-40,alpha:0},150).call(function(){this.removeChild(h)},this)},e}(egret.Sprite);egret.registerClass(Popup,"Popup");var LoadingUI=function(t){function e(){t.call(this),this.touchEnabled=!0,this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setLoading=function(t){this.graphics.clear(),egret.Tween.get(this.headImg,{loop:1}).to({rotation:-15},800).to({rotation:15},800).to({rotation:0},400),this.loadingImg.visible=this.headImg.visible=this.textField.visible=this.loadingBar.visible=!1,1==t?(this.visible=!0,this.graphics.beginFill(0),this.graphics.drawRect(0,0,Main.stageWidth,Main.stageHeight),this.headImg.visible=this.loadingBar.visible=!0,this.textField.visible=!0,this.textField.y=Main.stageHeight/2+.06*Main.stageWidth):2==t?(this.graphics.beginFill(0,.3),this.graphics.drawRect(0,0,Main.stageWidth,Main.stageHeight),this.visible=!0,this.headImg.visible=this.textField.visible=!0,this.textField.text="红包加载中...",this.textField.y=Main.stageHeight/2-.01*Main.stageWidth):3==t?(this.visible=!0,this.loadingImg.visible=!0,this.loadingImg.rotation=0,egret.Tween.get(this.loadingImg,{loop:1}).to({rotation:360},1200)):(this.loadingBar.graphics.clear(),egret.Tween.removeTweens(this.headImg),egret.Tween.removeTweens(this.loadingImg),this.headImg.rotation=0,this.visible=!1)},s.createView=function(){this.headImg=new egret.Bitmap(RES.getRes("loadingHead")),this.addChild(this.headImg),this.headImg.anchorOffsetX=.6*this.headImg.width,this.headImg.anchorOffsetY=.7*this.headImg.height,this.headImg.x=Main.stageWidth/2,this.headImg.y=Main.stageHeight/2-.1*Main.stageWidth,this.headImg.scaleX=this.headImg.scaleY=.6,this.textField=new egret.TextField,this.addChild(this.textField),this.textField.textColor=16711680,this.textField.y=Main.stageHeight/2+.06*Main.stageWidth,this.textField.width=Main.stageWidth,this.textField.height=100,this.textField.textAlign="center",this.loadingBar=new egret.Sprite,this.addChild(this.loadingBar),this.loadingBar.y=Main.stageHeight/2,this.loadingBar.x=.2*Main.stageWidth,this.loadingImg=new egret.Bitmap(RES.getRes("loading")),this.addChild(this.loadingImg),this.loadingImg.anchorOffsetX=this.loadingImg.width/2,this.loadingImg.anchorOffsetY=this.loadingImg.height/2,this.loadingImg.x=Main.stageWidth/2,this.loadingImg.y=this.loadingImg.height},s.setProgress=function(t,e){this.textField.text=Math.floor(t/e*100)+"%",this.loadingBar.graphics.clear(),this.loadingBar.graphics.lineStyle(4,12060162),this.loadingBar.graphics.drawRoundRect(0,0,.6*Main.stageWidth,20,30,30),this.loadingBar.graphics.endFill(),this.loadingBar.graphics.beginFill(12060162),this.loadingBar.graphics.drawRoundRect(5,5,(.6*Main.stageWidth-10)*t/e,10,25,25)},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){var i=navigator.userAgent,s=i.indexOf("Android")>-1||i.indexOf("Adr")>-1,h=!!i.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);(s||h)&&(this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH),e.stageWidth=this.stage.stageWidth,e.stageHeight=this.stage.stageHeight,this.gameLayer=new egret.Sprite,this.addChild(this.gameLayer),this.addChild(Popup.getInstance()),this.addChild(LoadView.getInstance()),Service.getInstance().getUrlInfo();var a=this;LoadView.getInstance().addEventListener("defaultJsonOk",function(){LoadView.getInstance().loadingGroup("loading",!1,function(){e.gameDescription=RES.getRes("description"),a.check_level(null),a=null})},this),LoadView.getInstance().load_defaultJson()},s.check_level=function(t){var i=Service.getInstance().gameLevel;if(1==i)-1==e.sc&&(e.sc=1),e.share("share1",Service.getInstance().userNickname,Service.getInstance().monsterName),this.gameScene1=new GameScene1,this.gameLayer.addChild(this.gameScene1);else if(2==i)Service.getInstance().redId||Popup.getInstance().myAlert2("packetId 为空"),e.sc=2,this.gameScene2=new GameScene2,this.gameLayer.addChild(this.gameScene2),this.gameScene2.addEventListener("gored",this.addPay,this);else if(3==i){var s=this;LoadView.getInstance().loadingGroup("scene2",!0,function(){Service.getInstance().getGameInfo(function(){s.moneyShow=new MoneyShow(!0),s.gameLayer.addChild(s.moneyShow),s.moneyShow.addEventListener("gored",s.addPay,s),Service.getInstance().getRedpacketInfo(function(){})})})}},s.addPay=function(){this.removeMoneyShow(),this.removeGameScene2(),e.sc=3,Service.getInstance().gameLevel=1,this.check_level(null)},s.removeGameScene2=function(){this.gameScene2&&(this.gameLayer.removeChild(this.gameScene2),this.gameScene2.removeEventListener("gored",this.addPay,this),this.gameScene2=null)},s.removeMoneyShow=function(){this.moneyShow&&(this.moneyShow.clear(),this.moneyShow.removeEventListener("gored",this.addPay,this),this.gameLayer.removeChild(this.moneyShow),this.moneyShow=null)},e.share=function(t,i,s,h){void 0===s&&(s=null),void 0===h&&(h=null);var a=e.gameDescription.shareInfo[t],n=a.title,r=a.desc;s||(s=""),i||(i=""),r=r.replace(/@mName/,s),r=r.replace(/@uName/,i),n=n.replace(/@mName/,s),n=n.replace(/@uName/,i),Service.getInstance().weixinShare(n,a.icon,r,h)},e.sc=-1,e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var MoneyShow=function(t){function e(e){void 0===e&&(e=!1),t.call(this),this.a=6,this.b=3,this.pHeight=0;var i=this;if(e){var s=new GameBg;this.addChild(s),s.initView(!1)}Service.getInstance().getOverInfo(function(t){i.init(Number(t.grabStatus),t.snagMoney,t.records,t.snagMoneys,t.totalMoney)})}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(t,e,i,s,h){0==t?this.b=2:2==t?this.b=3:this.b=1,this.initView(e,i,s,h)},s.initView=function(t,e,i,s){var h=new egret.Shape;h.graphics.beginFill(0,.5),h.graphics.drawRect(0,0,Main.stageWidth,Main.stageHeight),h.graphics.endFill(),this.addChild(h),this.proparea=new egret.Sprite,this.addChild(this.proparea);var a=new egret.Bitmap(RES.getRes("show_tit"));if(this.proparea.addChild(a),0==this.a){var n=new egret.Bitmap(RES.getRes("show0"));this.proparea.addChild(n),n.y=40}else if(1==this.a){var n=new egret.Bitmap(RES.getRes("show1"));this.proparea.addChild(n),n.x=5,n.y=40}else if(2==this.a){var n=new egret.Bitmap(RES.getRes("show2"));this.proparea.addChild(n),n.y=40}else if(3==this.a){var n=new egret.Bitmap(RES.getRes("show3"));this.proparea.addChild(n),n.x=5,n.y=40}else if(4==this.a){var n=new egret.Bitmap(RES.getRes("show4"));this.proparea.addChild(n),n.x=5,n.y=40}else if(5==this.a){var n=new egret.Bitmap(RES.getRes("show5"));this.proparea.addChild(n),n.x=5,n.y=40}else if(6==this.a){var n=new egret.Bitmap(RES.getRes("show6"));this.proparea.addChild(n),n.y=40}else if(7==this.a){var n=new egret.Bitmap(RES.getRes("show7"));this.proparea.addChild(n),n.x=10,n.y=40}else if(8==this.a){var n=new egret.Bitmap(RES.getRes("show8"));this.proparea.addChild(n),n.x=5,n.y=40}n.x+=50,n.alpha=0;var r=new egret.Bitmap(RES.getRes("show_area"));if(this.proparea.addChild(r),r.y=290,1==this.b){var o=new egret.TextField;o.textColor=12190470,o.text="您的手速太快了,获得了",o.size=32,o.bold=!0,o.y=r.y+40,o.textAlign="center",o.width=r.width,this.proparea.addChild(o);var d=new egret.Bitmap(RES.getRes("show_gift"));this.proparea.addChild(d),d.y=o.y+70,t.length<=5?d.width*=1.2:t.length<=10&&(d.width*=1.4),d.x=r.width/2-d.width/2;var o=new egret.TextField;o.textColor=16777215,o.width=d.width,o.textAlign="center",o.text=t+"元",o.size=70,o.bold=!0,o.x=d.x+10,o.y=d.y+d.height/2-o.size/2,this.proparea.addChild(o)}else if(2==this.b){var g=new egret.TextField;g.textColor=12190470,g.text="年兽红包被抢光啦,\n快来发布你的年兽红包吧",g.size=35,g.bold=!0,g.textAlign="center",g.width=r.width,g.y=r.y+100,g.lineSpacing=20,this.proparea.addChild(g)}else if(3==this.b){var g=new egret.TextField;g.textColor=12190470,g.text="一个都没中?? 下次请瞄准一点",g.size=35,g.bold=!0,g.textAlign="center",g.width=r.width,g.y=r.y+130,this.proparea.addChild(g)}var c=new egret.TextField;c.textColor=10066329,c.text="已被抢走"+i+"元,共"+s+"元",c.size=25,c.y=r.y+.55*Main.stageWidth,c.textAlign="center",c.width=r.width,this.proparea.addChild(c),this.shareMoney=new MyButton("show_set"),this.proparea.addChild(this.shareMoney),this.shareMoney.y=r.y+.6*r.width,this.shareMoney.x=r.width/2;var l=new egret.Sprite,m=new egret.ScrollView;m.horizontalScrollPolicy="off",m.setContent(l),m.width=.7*Main.stageWidth-40,m.height=.35*Main.stageWidth,m.x=r.width/2-m.width/2,m.y=r.y+r.height-m.height-24,this.proparea.addChild(m),this.fb=new egret.Bitmap(RES.getRes("show_fb")),this.proparea.addChild(this.fb),this.fb.anchorOffsetX=this.fb.width/2,this.fb.anchorOffsetY=this.fb.height/2,this.fb.x=10+this.fb.width/2,this.fb.y=350+this.fb.height/2,this.fb.scaleX=this.fb.scaleY=0,this.fs=new egret.Bitmap(RES.getRes("show_fs")),this.proparea.addChild(this.fs),this.fs.anchorOffsetX=this.fs.width/2,this.fs.anchorOffsetY=this.fs.height/2,this.fs.x=500+this.fs.width/2,this.fs.y=500+this.fs.height/2,this.fs.scaleX=this.fs.scaleY=0,this.proparea.anchorOffsetX=this.proparea.width/2,this.proparea.anchorOffsetY=this.proparea.height/2,this.pHeight=this.proparea.height,this.pai(l,m.width,e),this.startAni(n)},s.pai=function(t,e,i){for(var s=Main.gameDescription.designation_list,h=0;h<i.length;h++){var a=new egret.Sprite;t.addChild(a),a.graphics.lineStyle(2,16711680),a.graphics.drawCircle(32,30,32);var n=new egret.Shape;a.addChild(n),n.graphics.beginFill(16724753,1),n.graphics.drawCircle(30,30,30);var r=new egret.Bitmap;a.addChild(r),r.width=r.height=60,r.x=n.x=2,LoadView.getInstance().load_img(r,i[h].avatar),r.mask=n;var o=new egret.TextField;o.textColor=12190470,o.text="No."+Number(h+1),o.size=30,o.y=(60-o.size)/2,o.x=r.x+r.width+25,a.addChild(o);var o=new egret.TextField;o.textColor=12190470;var d=Number(i[h].percent);for(var g in s)if(d>=Number(s[g].num)){o.text=s[g].name;break}o.x=3*r.width,o.size=30,o.y=(60-o.size)/2,a.addChild(o);var o=new egret.TextField;o.textColor=12190470,o.width=.3*e,o.text=i[h].money+"元",o.textAlign="right",o.x=e-o.width,o.size=30,o.y=(60-o.size)/2,a.addChild(o),a.y=70*h+2}t.graphics.beginFill(7829367,0),t.graphics.drawRect(0,0,t.width,t.height)},s.startAni=function(t){this.proparea.y=-this.pHeight/2,this.proparea.x=.51*Main.stageWidth;var e=.47*Main.stageHeight;if(this.pHeight>.9*Main.stageHeight){var i=.9*Main.stageHeight/this.pHeight;this.proparea.scaleX=this.proparea.scaleY=i}egret.Tween.get(this.proparea).to({y:e},600,egret.Ease.backOut).call(function(){egret.Tween.get(t).to({alpha:1},900),this.fb.y=180+this.fb.height/2,this.fs.y=400+this.fs.height/2,egret.Tween.get(this.fb).to({scaleX:1,scaleY:1},600),egret.Tween.get(this.fs).to({scaleX:1,scaleY:1},500),this.initEvent()},this),this.addEventListener(egret.Event.ENTER_FRAME,this.onenter,this)},s.onenter=function(t){this.yanhua&&this.yanhua.move()&&(this.removeChild(this.yanhua),this.yanhua=null),this.yanhua2&&this.yanhua2.move()&&(this.removeChild(this.yanhua2),this.yanhua2=null)},s.initEvent=function(){this.shareMoney.addTouchEvent(),this.shareMoney.addEventListener("click",this.goPay,this);var t;this.shareMoney.addEventListener(egret.TouchEvent.TOUCH_END,function(){t||(t=RES.getRes("cBack"),e.sc=t.play(0,100))},this),this.startGame()},s.goPay=function(){Service.getInstance().redId=null,Service.getInstance().monsterName=null,Service.getInstance().headBase64Data=null,Service.getInstance().userNickname=Service.getInstance().userNickname2,this.dispatchEvent(new egret.Event("gored"))},s.startGame=function(){this.overAni()},s.overAni=function(){},s.clear=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onenter,this)},e}(egret.Sprite);egret.registerClass(MoneyShow,"MoneyShow");var Monster=function(t){function e(){t.call(this),this.moveSpeed=0,this.moveSpeed=Main.gameDescription.monsterSpeed}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setRightType=function(){this.removeBody(),this.addBody("s2_rmonster"),this.body.anchorOffsetX=this.body.width/2,this.body.anchorOffsetY=this.body.height/2},s.setMoveType=function(){this.removeBody(),this.addBody("s2_body2"),this.body.anchorOffsetY=this.body.height/2,this.setHeadType(1)},s.setHitType=function(){this.removeBody(),this.addBody("s2_body1"),this.body.anchorOffsetY=this.body.height/2,this.setHeadType(2),this.fuhuiType();var t=RES.getRes("getscore_music");t.play(0,1)},s.setNoHitType=function(){this.removeBody(),this.addBody("s2_body3"),this.body.y=-75,this.body.x=60,this.setHeadType(3),this.fuhuiType();var t=RES.getRes("laugh_music");t.play(0,1)},s.fuhuiType=function(){clearTimeout(this.time);var t=this;this.time=setTimeout(function(){t.setMoveType()},400)},s.setHeadMove=function(){egret.Tween.get(this.headSp,{loop:1}).to({rotation:-10},600).to({rotation:0},300)},s.update=function(){this.x+=this.moveSpeed,this.x<10?(this.x=10,this.moveSpeed=Math.abs(this.moveSpeed)):this.x+this.width>Main.stageWidth-10&&(this.x=Main.stageWidth-this.width-10,this.moveSpeed=-Math.abs(this.moveSpeed))},s.setHeadType=function(t){this.headSp||(this.headSp=new egret.Sprite,this.addChild(this.headSp),this.headSp.anchorOffsetX=.13*Main.stageWidth,this.headSp.anchorOffsetY=.12*Main.stageWidth,Service.getInstance().monsterHeadimgurl&&(this.headUserImg=new egret.Bitmap,this.headSp.addChild(this.headUserImg),this.headUserImg.width=.13*Main.stageWidth,this.headUserImg.height=.7*this.headUserImg.width,LoadView.getInstance().load_img(this.headUserImg,Service.getInstance().monsterHeadimgurl))),this.removeHeadBg(),this.removeHeadBiaoQiao(),1==t?(this.addHeadBg("s2_nhead1"),this.addHeadBiaoQiao("biaoqing"),this.headSp.x=5+this.headSp.anchorOffsetX,this.headSp.y=-170+this.headSp.anchorOffsetY,this.headUserImg&&(this.headUserImg.x=30,this.headUserImg.y=90,this.headUserImg.rotation=-32),this.headBiaoQing.x=35,this.headBiaoQing.y=70):2==t?(this.addHeadBg("s2_nhead2"),this.addHeadBiaoQiao("s2_cry"),this.headSp.x=35+this.headSp.anchorOffsetX,this.headSp.y=-175+this.headSp.anchorOffsetY,this.headUserImg&&(this.headUserImg.x=28,this.headUserImg.y=80,this.headUserImg.rotation=-28)):3==t&&(this.addHeadBg("s2_nhead3"),this.addHeadBiaoQiao("s2_laugh"),this.headSp.x=35+this.headSp.anchorOffsetX,this.headSp.y=-175+this.headSp.anchorOffsetY,this.headUserImg&&(this.headUserImg.x=25,this.headUserImg.y=85,this.headUserImg.rotation=-32,this.headBiaoQing.visible=!1))},s.removeHeadBg=function(){this.headBg&&(this.headSp.removeChild(this.headBg),this.headBg=null)},s.addHeadBg=function(t){this.headBg=new egret.Bitmap(RES.getRes(t)),this.headSp.addChildAt(this.headBg,0)},s.removeHeadBiaoQiao=function(){this.headBiaoQing&&(this.headSp.removeChild(this.headBiaoQing),this.headBiaoQing=null)},s.addHeadBiaoQiao=function(t){this.headBiaoQing=new egret.Bitmap(RES.getRes(t)),this.headSp.addChild(this.headBiaoQing),this.headBiaoQing.x=30,this.headBiaoQing.y=45},s.removeBody=function(){this.body&&(this.removeChild(this.body),this.body=null)},s.addBody=function(t){this.body=new egret.Bitmap(RES.getRes(t)),this.addChildAt(this.body,0)},e}(egret.Sprite);egret.registerClass(Monster,"Monster");var MusicBtn=function(t){function e(){t.call(this),this.musicbtn()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.musicbtn=function(){this.mbtn1=new egret.Bitmap(RES.getRes("s2_open")),this.addChild(this.mbtn1),this.mbtn1.anchorOffsetX=this.mbtn1.width/2,this.mbtn1.anchorOffsetY=this.mbtn1.height/2,this.mbtn1.x=705,this.mbtn1.y=60,egret.Tween.get(this.mbtn1,{loop:1}).to({rotation:360},1e3),this.mbtn1.touchEnabled=!0,this.mbtn1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.closeMusic,this),this.mbtn2=new egret.Bitmap(RES.getRes("s2_close")),this.addChild(this.mbtn2),this.mbtn2.anchorOffsetX=this.mbtn2.width/2,this.mbtn2.anchorOffsetY=this.mbtn2.height/2,this.mbtn2.x=705,this.mbtn2.y=60,this.mbtn2.alpha=0},s.closeMusic=function(){1===Main.sc?egret.setSound(1,0):2==Main.sc?egret.setSound(2,0):3==Main.sc&&MoneyShow.sc&&MoneyShow.sc.stop(),egret.Tween.removeTweens(this.mbtn1),this.mbtn1.alpha=0,this.mbtn2.alpha=1,this.mbtn2.touchEnabled=!0,this.mbtn2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.openMusic,this)},s.openMusic=function(){if(1===Main.sc)egret.setSound(1,1);else if(2==Main.sc)egret.setSound(2,1);else if(3==Main.sc&&MoneyShow.sc){MoneyShow.sc.stop();var t=RES.getRes("cBack");MoneyShow.sc=t.play(0,100)}this.mbtn2.touchEnabled=!1,this.mbtn1.alpha=1,this.mbtn2.alpha=0,this.mbtn1.touchEnabled=!0,this.mbtn1.rotation=0,egret.Tween.get(this.mbtn1,{loop:1}).to({rotation:360},1e3)},e}(egret.Sprite);egret.registerClass(MusicBtn,"MusicBtn");var Lizi=function(t){function e(){t.call(this),this.rRotation=0,this.speed=0,this.g=0,this.type=0,this.vy=0,this.px=0,this.py=0,this.maxDis=0,this.dis=0,this.param1=!1,this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.rRotation=360*Math.random(),this.speed=4*Math.random(),this.maxDis=30*Math.random(),this.g=.6*Math.random()+.6,this.x=Math.cos(Math.PI*this.rRotation/180)*Math.random()*this.speed*5,this.y=Math.sin(Math.PI*this.rRotation/180)*Math.random()*this.speed*5},s.move=function(){this.px+=Math.cos(Math.PI*this.rRotation/180)*this.speed,this.py+=Math.sin(Math.PI*this.rRotation/180)*this.speed;var t;if(this.param1){if(this.speed*=.87,this.speed<.3)return!0;this.py+=this.vy,this.vy+=this.g,this.vy*=.8;var e=this.speed/3;3>e?e=3:e>8&&(e=8),t=new Lizi2(this.color,e)}else this.dis++,this.speed*=1.02,this.dis>=this.maxDis&&(this.param1=!0,this.dis=0),t=new Lizi2(this.color,3,500,.5);return t&&(this.addChild(t),t.x=this.px,t.y=this.py),!1},e}(egret.Sprite);egret.registerClass(Lizi,"Lizi");var Lizi2=function(t){function e(e,i,s,h){void 0===s&&(s=400),void 0===h&&(h=1),t.call(this),this.graphics.beginFill(e),this.graphics.drawRect(0,0,i,i),this.graphics.endFill(),this.alpha=h,egret.Tween.get(this).to({alpha:0},s).call(this.over,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.over=function(){this.parent.removeChild(this)},e}(egret.Shape);egret.registerClass(Lizi2,"Lizi2");var Lizi3=function(t){function e(e,i){t.call(this),this.rRotation=0,this.px=0,this.speed=2,this.type=1,this.rRotation=i,this.graphics.beginFill(e),this.graphics.drawCircle(0,0,2),this.graphics.endFill()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.move=function(){if(this.x+=Math.cos(Math.PI*this.rRotation/180)*this.speed,this.y+=Math.sin(Math.PI*this.rRotation/180)*this.speed,1==this.type){if(this.alpha-=.02,this.alpha<.01)return!0}else this.px++,this.px>40&&(this.type=1);return this.speed*=.95,!1},e}(egret.Shape);egret.registerClass(Lizi3,"Lizi3");var YanHuaView=function(t){function e(){t.call(this),this.type=0,this.t1_speed=0,this.t1_vy=0,this.t1_maxY=0,this.t1_vH=0,this.t1_alpha=0,this.t1_aType1=0,this.color=0,this.list=[],this.list3=[],this.t1_speed=2*Math.random()+2,this.t1_vH=255}__extends(e,t);var i=(__define,e),s=i.prototype;return s.move=function(){return 0==this.type?(this.ani1(),this.list.length>0&&this.ani2()):1==this.type&&this.ani2(),!1},s.initAni2=function(){for(var t=10*Math.random()+160,e=0;t>e;e++){var i=new Lizi;i.color=this.color,this.addChild(i),this.list.push(i)}for(var s=t,e=0;s>e;e++){var h=360*Math.random(),a=new Lizi3(this.color,h);e>s/3*2?(a.x=Math.cos(Math.PI*h/180)*(6*Math.random()+2*a.speed),a.y=Math.sin(Math.PI*h/180)*(6*Math.random()+2*a.speed),a.alpha=.2*Math.random()+.8,a.speed=1*Math.random()+4):(a.x=Math.cos(Math.PI*h/180)*Math.random()*a.speed*2,a.y=Math.sin(Math.PI*h/180)*Math.random()*a.speed*2,a.speed=5*Math.random(),a.alpha=a.speed/5+.2),this.addChild(a),this.list3.push(a)}},s.ani2=function(){if(this.list){for(var t=this.list.length-1;t>=0;t--)this.list[t].move()&&(this.removeChild(this.list[t]),this.list[t]=null,this.list.splice(t,1));for(t=this.list3.length-1;t>=0;t--)this.list3[t].move()&&(this.removeChild(this.list3[t]),this.list3[t]=null,this.list3.splice(t,1))}},s.ani1=function(){this.graphics.clear(),this.t1_vH>255?this.t1_vH=255:this.t1_vH<1&&(this.t1_vH=1),this.graphics.beginGradientFill(egret.GradientType.RADIAL,[this.color,this.color],[this.t1_alpha,1],[this.t1_vH,0]),this.graphics.drawEllipse(0,0,5,160),this.graphics.endFill(),this.y>this.t1_maxY?(this.t1_vy+=this.t1_speed,this.y-=this.t1_vy,this.t1_vH+=10*this.t1_speed):this.t1_vH>4?(this.t1_vH-=12*this.t1_speed,0==this.list.length&&this.initAni2()):(this.graphics.clear(),this.type=1),0==this.t1_aType1?(this.t1_alpha+=.1,this.t1_alpha>=1&&(this.t1_aType1=1)):1==this.t1_aType1&&(this.t1_alpha-=.1,this.t1_alpha<=.1&&(this.t1_alpha=0))},e}(egret.Sprite);egret.registerClass(YanHuaView,"YanHuaView");