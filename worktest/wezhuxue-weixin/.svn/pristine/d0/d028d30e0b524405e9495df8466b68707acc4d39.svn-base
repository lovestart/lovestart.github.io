<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>人人助学</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<link href="css/base.css" rel="stylesheet" type="text/css" media="all"/>
<link href="css/common.css" rel="stylesheet" type="text/css" media="all"/>
<script src="js/mobile.js"></script>
</head>

<body>
<!--header starts-->
	<!-- <div class="header">
        <div class="hedLft">
            <a href="#"><img src="images/headarrow.png"></a>
        </div>
        headerLeft
        <div class="headerMiddle">
            <h1>人人助学</h1>
        </div>
    headerMiddle
	</div> -->
<!--header ends-->
<!--container starts-->
<div class="container">
	<div class="containerOnetwo">
    	<div class="secondbg">
            <div class="bgtext">
                <h1>恭喜您获得5000元助学券</h1>
                <h1>仅需1元，即可完成助学</h1>
            </div>
        </div>
        <div class="mainbg">
            <div class="likeTab clearfloat">
                <div class="first fl">
                    <h2 id="nhll" class="tabbrbdr">5.5%</h2>
                    <h4 class="fourhead">预计年化收益率</h4>
                </div>
                <div class="first fl">
                    <h2 id="qx">3天</h2>
                    <h4 class="fourhead">期限</h4>
                </div>
            </div>
            <div class="cntrSctn">
                <div class="cntrauto">
                    <h1 class="secondHeadOne brdrnone"><span class="textbrdr"></span>助学金额</h1>
                    <div class="bordepart">
                    <h3 id="pay">￥1</h3>
                    <h4 class="fourhead">预计分散帮助30名学生，由人人助学助学团全额贴息。</h4></div>
                </div>
            </div>
            <div class="chechSctn">
                <input type="checkbox" id="check" checked/>
                <label class="checklabel" for="check">同意《人人助学服务协议》</label>
            </div>
            <div class="fixedSctn">
                <button class="orangebtn">微信支付</button>
            </div>
        </div>
    </div>
    <div id="oDiv" style="position: fixed; left: 0px; right: 0px; top: 0px; bottom: 0px; display: none"></div>
</div>
<!--container ends-->
<!--footer starts-->

<!--footer ends-->


</body>
</html>
<script type="text/javascript" src="js/public.js" ></script>
<script type="text/javascript" src="js/zepto.min.js" ></script>
<script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">
    $(function(){
        var UrlData=window.location.search;
        var locationData={};//接收链接地址传输的数据
        var mainData={};//助学团详情json
        var jsonDataObj={};//获取微信传来的数据
        
        (UrlData==='')&&(true,locationData='nullObject') || (UrlData!='') && (true,locationData=pub.StrToJOON(UrlData));
        //判断有没有获取数据 ps:获取到了去读数据，没有获取到提示没有获取到
        (locationData === 'nullObject')&&(true,(function(){
            $('#oDiv').show();
            pub.cs('没有获取到数据！');
        })()) || (locationData!='nullObject')&&(true,function(){
            getProductDetail();//获取帮助所有帮助提升身价的小伙伴
        }());//判断有没有获取数据 end
        
        //获取帮助提升身价小伙伴列表的方法
        function getProductDetail(){
            var datas ={'version':'1.0','system':'weixin','token':'','objId':'ProductAndAccountInfoVO','method':'/finance/accountAndProduct/balance','@userId':''+locationData.userId+'','@productId':''+locationData.productId+'','@couponId':''+locationData.couponId+'','@type':'3'};
            $.ajax({
                dataType:'jsonp',
                url:pub.jsonPApiT,
                data:datas,
                jsonp:'callback',
                success:function(jsonData){
                    mainData=eval(jsonData);
					if(mainData.code=='6666'){
						 $('#nhll').html(mainData.data.n_yieldRate+"%");
	                     $('#qx').html(mainData.data.n_termDay+"天");
	                     $('#pay').html('￥'+mainData.data.n_needPay);
					}else{
						$('#oDiv').show();
                        pub.cs(mainData.msg);
                        $("button").attr('disabled',true);
					}
                },
            });
        };//获取帮助提升身价小伙伴列表的方法 end
        /* var sData={'url':'http://wx.wezhuxue.com/wezhuxue-weixin/views/zxt/yiBuy.html'};
		$.get(pub.wxSignApi,sData,function(data){
			jsonDataObj=JSON.parse(data);
			if(jsonDataObj.code==200){
				
			}else{
				$('#oDiv').show();
                pub.cs(jsonDataObj.msg);
			}
		}); */
		// 微信配置  
		/*wx.config({  
		    debug: false,   
		    appId: jsonDataObj.appId,   
		    timestamp: jsonDataObj.timeStamp,   
		    nonceStr: jsonDataObj.nonceStr,   
		    signature: jsonDataObj.signature,  
		    jsApiList: ['chooseWXPay'] // 功能列表，我们要使用JS-SDK的什么功能  
		});   */
        var appId,timeStamp,nonceStr,signType,prepayId,paySign;
		function onBridgeReady(){   
			WeixinJSBridge.invoke( 
				'getBrandWCPayRequest', { 
					"appId" : appId, //公众号名称，由商户传入 
					"timeStamp" : timeStamp, //时间戳，自1970年以来的秒数 
					"nonceStr" : nonceStr, //随机串 
					"package" : "prepay_id=" + prepayId, 
					"signType" : signType, //微信签名方式: 
					"paySign" : paySign //微信签名 
				}, 
				function(res){ 
					if(res.err_msg == "get_brand_wcpay_request:ok" ) { 
						//回到用户订单列表  
		                window.location.href="http://wx.wezhuxue.com/wezhuxue-weixin/views/zxt_stu/zxSuccess.html"; 
					} // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回 ok，但并不保证它绝对可靠。 
					else if (res.err_msg == "get_brand_wcpay_request:cancel")  {  
		                alert("支付过程中用户取消");  
		            }else{  
		               //支付失败  
		               alert(res.err_msg)  
		            }  			
				} 
			); 
		} 
		$('button').click(function(){ 
			//微信jssdk签名 
	        var datas ={'version':'1.0','system':'weixin','token':'','objId':'PayVO','method':'/weixin/signature','@userId':''+locationData.userId+'','@amount':'1','@subject':'1元助学','@type':'2','@remoteAddr':''+returnCitySN["cip"]+'','@openId':''+locationData.openId+'','@productId':''+mainData.data.productId+'','@couponId':''+locationData.couponId+'','@shareUserId':''+locationData.shareUserId+''};
	        $.ajax({
	            dataType:'jsonp',
	            url:pub.jsonPApiT,
	            data:datas,
	            jsonp:'callback',
	            async:false,
	            success:function(jsonData){
	                mainData=eval(jsonData);
					if(mainData.code=='6666'){
						 appId = mainData.data.appId;
						 timeStamp = mainData.data.timeStamp;
						 nonceStr = mainData.data.nonceStr;
						 signType = mainData.data.signType;
						 prepayId = mainData.data.prepayId;
						 paySign = mainData.data.sign;
					}else{
						$('#oDiv').show();
	                    pub.cs(mainData.msg);
	                    $("button").attr('disabled',true);
					}
	            },
	        });
	        if(appId){
				if (typeof WeixinJSBridge == "undefined"){ 
					if( document.addEventListener ){ 
						document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false); 
			 		}else if (document.attachEvent){ 
			  			document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
			  			document.attachEvent('onWeixinJSBridgeReady', onBridgeReady); 
			 		}
				}else{ 
			 		onBridgeReady(); 
			 	} 
	        }
		});
	});
</script>